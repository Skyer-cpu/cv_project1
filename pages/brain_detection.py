import streamlit as st
from PIL import Image
import requests
from io import BytesIO
from ultralytics import YOLO
import matplotlib.pyplot as plt
import seaborn as sns
import numpy as np
import os

st.set_page_config(page_title="Brain Tumor Detection", layout="wide")
st.title("üß† –î–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞ (YOLOv11)")

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
MODEL_DIR = "models"
MODEL_NAME = "dinara_yolov11_best.pt"
MODEL_PATH = os.path.join(MODEL_DIR, MODEL_NAME)


# --- –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ ---
@st.cache_resource # –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ
def load_model(path):
    if not os.path.exists(path):
        st.error(f"–û—à–∏–±–∫–∞: –§–∞–π–ª –º–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ {path}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ '{MODEL_NAME}' –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ '{MODEL_DIR}'.")
        return None
    try:
        model = YOLO(path)
        st.success(f"–ú–æ–¥–µ–ª—å '{MODEL_NAME}' —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ú–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.")
        return model
    except Exception as e:
        st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏: {e}")
        return None

model = load_model(MODEL_PATH)

# ===== –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π =====
tab1, tab2 = st.tabs(["üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", "üåê –ü–æ —Å—Å—ã–ª–∫–µ"])

imgs = []

with tab1:
    uploaded_files = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:", type=["jpg", "png"], accept_multiple_files=True)
    for file in uploaded_files:
        imgs.append(Image.open(file))

with tab2:
    url = st.text_input("–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (jpeg/png):")
    if url:
        try:
            response = requests.get(url)
            img = Image.open(BytesIO(response.content))
            imgs.append(img)
        except:
            st.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —Å—Å—ã–ª–∫–µ.")

# ===== –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ =====
if imgs:
    for img in imgs:
        st.markdown("---")
        st.image(img, caption="–û—Ä–∏–≥–∏–Ω–∞–ª", width=400)

        # YOLOv11 –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
        results = model.predict(img, conf=0.25)

        for r in results:
            annotated_img = r.plot()  # –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –±–æ–∫c–∞–º–∏
            st.image(annotated_img, caption="–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏", width=600)

# ===== –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏ =====
with st.expander("‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏"):
    st.markdown("""
    ### **YOLOv11** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–ø—É—Ö–æ–ª–µ–π –Ω–∞ MR-—Å–Ω–∏–º–∫–∞—Ö.

    - üì¶ **–†–∞–∑–º–µ—Ä –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏:** 310 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
    - üì¶ **–†–∞–∑–º–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏:** 75 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
    - üîÅ **–≠–ø–æ—Ö–∏ –æ–±—É—á–µ–Ω–∏—è:** 50 —ç–ø–æ—Ö *3 –º–æ–¥–µ–ª–∏ = 150  
    - üéØ **mAP50:** 0.88  
    - üéØ **mAP50-95:** 0.60
    """)


    # –ó–∞–≥—Ä—É–∑–∫–∞ MaP
    st.markdown("**–ì–†–ê–§–ò–ö ‚Ññ1: mAP - –¥–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞ (YOLOv11):**")
    cm_image = Image.open("images/dinara_map.jpg")
    st.image(cm_image, caption="Confusion Matrix", use_container_width=True)
    st.markdown("""
    #### 1.1. –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
    ###### mAP@0.5 (mAP50)
    –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ Intersection over Union (IoU) = 0.5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –º–æ–¥–µ–ª—å –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã —Å —É–º–µ—Ä–µ–Ω–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.

    –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π:

    < 0.5 ‚Äî –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ.

    0.5‚Äì0.7 ‚Äî —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ.

    .> 0.7 ‚Äî —Ö–æ—Ä–æ—à–æ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞—á).

    ###### mAP@0.5:0.95 (mAP50-95)
    –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ. –î–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ–ø—É—Ö–æ–ª–∏ –º–æ–∑–≥–∞) —Å—Ç–æ–∏—Ç —É–ª—É—á—à–∞—Ç—å.

    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö: –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ bounding boxes.

    –î–æ–±–∞–≤—å—Ç–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: –ø–æ–≤–æ—Ä–æ—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏/–∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –æ–±–æ–±—â–µ–Ω–∏–µ.
    
    #### 1.2. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
    ##### –ï—Å–ª–∏ mAP50 –±–ª–∏–∑–æ–∫ –∫ 50 (0.5):
    –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ. –î–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–æ–ø—É—Ö–æ–ª–∏ –º–æ–∑–≥–∞) —Å—Ç–æ–∏—Ç —É–ª—É—á—à–∞—Ç—å.

    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö: –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ bounding boxes.

    –î–æ–±–∞–≤—å—Ç–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: –ø–æ–≤–æ—Ä–æ—Ç—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏/–∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å –æ–±–æ–±—â–µ–Ω–∏–µ.

    ##### –ï—Å–ª–∏ mAP50-95 —Å–∏–ª—å–Ω–æ –æ—Ç—Å—Ç–∞—ë—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 20 –ø—Ä–æ—Ç–∏–≤ 50):

    –ú–æ–¥–µ–ª—å –ø–ª–æ—Ö–æ –ª–æ–∫–∞–ª–∏–∑—É–µ—Ç –æ–ø—É—Ö–æ–ª–∏ –ø—Ä–∏ —Å—Ç—Ä–æ–≥–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö (IoU > 0.5).

    –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

    –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –æ–ø—É—Ö–æ–ª–∏ –º–µ–ª–∫–∏–µ).

    –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å —Å –±–æ–ª—å—à–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º (YOLOv8l –∏–ª–∏ YOLOv9x).

    ##### –ï—Å–ª–∏ –∫—Ä–∏–≤—ã–µ –≤—ã—Ö–æ–¥—è—Ç –Ω–∞ –ø–ª–∞—Ç–æ –ø–æ—Å–ª–µ 30 —ç–ø–æ—Ö:

    –î–∞–ª—å–Ω–µ–π—à–µ–µ –æ–±—É—á–µ–Ω–∏–µ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ. –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –Ω–∞ 30‚Äì40 —ç–ø–æ—Ö–∞—Ö.
                
    """)
    

    # –ó–∞–≥—Ä—É–∑–∫–∞ F1
    st.markdown("**–ì–†–ê–§–ò–ö ‚Ññ2 box_f1_curve - –¥–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞ (YOLOv11):**")
    cm_image = Image.open("images/dinara_BoxF1_curve.png")
    st.image(cm_image, caption="Confusion Matrix", use_container_width=True)
    
    st.markdown("""
    #### 2.1. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏–∫?:
    –≠—Ç–æ F1-Score –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Confidence Threshold (–ø–æ—Ä–æ–≥–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏). –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é (Precision) –∏ –ø–æ–ª–Ω–æ—Ç–æ–π (Recall).

    –û—Å—å X: Confidence Threshold (–æ—Ç 0 –¥–æ 1).

    –û—Å—å Y: F1-Score (–æ—Ç 0 –¥–æ 1, –≥–¥–µ 1 ‚Äî –∏–¥–µ–∞–ª).

    –õ–µ–≥–µ–Ω–¥–∞:

    negative ‚Äî –º–µ—Ç–∫–∞ –∫–ª–∞—Å—Å–∞ ("–Ω–µ—Ç –æ–ø—É—Ö–æ–ª–∏").

    all classes 0.83 at 0.185 ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π F1-Score (0.83) –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—Ä–æ–≥–µ 0.185.
    
    #### 2.2. –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:
    ##### –ü–∏–∫ F1-Score = 0.83 –ø—Ä–∏ Confidence Threshold ~0.185.

    –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –ª—É—á—à–µ –≤—Å–µ–≥–æ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø–æ–ª–Ω–æ—Ç–æ–π –Ω–∞ —ç—Ç–æ–º –ø–æ—Ä–æ–≥–µ.

    –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Ä–æ–≥ –≤—ã—à–µ, –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø—É—Ö–æ–ª–∏ –ø—Ä–æ–ø—É—Å—Ç—è—Ç—Å—è.

    –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Ä–æ–≥ –Ω–∏–∂–µ, –º–æ–¥–µ–ª—å —Å—Ç–∞–Ω–µ—Ç "–ø–∞—Ä–∞–Ω–æ–∏–¥–∞–ª—å–Ω–æ–π" (–Ω–∞–π–¥—ë—Ç –±–æ–ª—å—à–µ –æ–ø—É—Ö–æ–ª–µ–π, –Ω–æ —Å –±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º –æ—à–∏–±–æ–∫).

    ##### –§–æ—Ä–º–∞ –∫—Ä–∏–≤–æ–π:

    F1-Score —Ä–µ–∑–∫–æ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ Confidence Threshold > 0.5 ‚Äî –∑–Ω–∞—á–∏—Ç, –º–æ–¥–µ–ª—å —Ä–µ–¥–∫–æ –±—ã–≤–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–∞ –≤ —Å–≤–æ–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö –Ω–∞ –≤—ã—Å–æ–∫–∏—Ö –ø–æ—Ä–æ–≥–∞—Ö.

    –≠—Ç–æ —Ç–∏–ø–∏—á–Ω–æ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –≥–¥–µ –æ–ø—É—Ö–æ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∞–±–æ –≤—ã—Ä–∞–∂–µ–Ω—ã.
                
    #### 2.3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 0.185 –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ F1-Score.

    ##### –ü—Ä–æ–≤–µ—Ä–∫–∞ Precision –∏ Recall:

    –ï—Å–ª–∏ –≤–∞–∂–Ω–µ–µ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –Ω–µ –ø—É–≥–∞—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –±–µ–∑ –æ–ø—É—Ö–æ–ª–∏), –ø–æ–≤—ã—Å—å—Ç–µ –ø–æ—Ä–æ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ 0.3‚Äì0.4).

    –ï—Å–ª–∏ –≤–∞–∂–Ω–µ–µ –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–π –æ–ø—É—Ö–æ–ª–∏, –æ–ø—É—Å—Ç–∏—Ç–µ –ø–æ—Ä–æ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ 0.1).

    ##### –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫:

    –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ False Positive (–ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è) –∏ False Negative (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –æ–ø—É—Ö–æ–ª–∏) –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ—Ä–æ–≥–µ.

    –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –¥–æ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö.
                
    #### 2.4. –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∑–∞–¥–∞—á–∏
    F1-Score 0.83 ‚Äî —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—ã —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É—é—Ç > 0.9.

    ##### –ü–æ—á–µ–º—É Confidence Threshold —Ç–∞–∫–æ–π –Ω–∏–∑–∫–∏–π (0.185)?

    –ú–æ–¥–µ–ª—å "–ø–µ—Ä–µ—Å—Ç—Ä–∞—Ö–æ–≤—ã–≤–∞–µ—Ç—Å—è" –∏–∑-–∑–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ–ª–∫–∏–µ –∏–ª–∏ —Å–ª–∞–±–æ–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –æ–ø—É—Ö–æ–ª–∏).

    –í–æ–∑–º–æ–∂–Ω–æ, –≤ –¥–∞–Ω–Ω—ã—Ö –º–Ω–æ–≥–æ "—à—É–º–Ω—ã—Ö" –ø—Ä–∏–º–µ—Ä–æ–≤.
    """)

    


    # –ó–∞–≥—Ä—É–∑–∫–∞ PR-–∫—Ä–∏–≤–æ–π –∏–∑ —Ñ–∞–π–ª–∞
    st.markdown("**–ì–†–ê–§–ò–ö ‚Ññ3 PR-–∫—Ä–∏–≤–∞—è - –¥–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞ (YOLOv11):**")
    pr_curve = Image.open("images/dinara_BoxPR_curve.png")
    st.image(pr_curve, caption="PR-–∫—Ä–∏–≤–∞—è", use_container_width=True)

    st.markdown("""
        #### 3.1. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç PR-–∫—Ä–∏–≤–∞—è?
    PR-–∫—Ä–∏–≤–∞—è –æ—Ç—Ä–∞–∂–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É:

    ##### Precision (–¢–æ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–æ–ª—è –≤–µ—Ä–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö.

    –ü—Ä–∏–º–µ—Ä: 0.883 = 88.3% –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —è–≤–ª—è—é—Ç—Å—è –æ–ø—É—Ö–æ–ª—è–º–∏.

    ##### Recall (–ü–æ–ª–Ω–æ—Ç–∞) ‚Äî –¥–æ–ª—å –≤–µ—Ä–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö.

     –ü—Ä–∏–º–µ—Ä: 0.6 = 60% –æ–ø—É—Ö–æ–ª–µ–π –Ω–∞–π–¥–µ–Ω–æ.

    –ß–µ–º –±–ª–∏–∂–µ –∫—Ä–∏–≤–∞—è –∫ –ø—Ä–∞–≤–æ–º—É –≤–µ—Ä—Ö–Ω–µ–º—É —É–≥–ª—É (Precision=1, Recall=1), —Ç–µ–º –ª—É—á—à–µ –º–æ–¥–µ–ª—å.
    
    #### 3.2. –ò–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞—á
    Precision > 0.9 (–º–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥–Ω–æ–∑–æ–≤).

    Recall > 0.8 (–ø–æ—á—Ç–∏ –≤—Å–µ –æ–ø—É—Ö–æ–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã).

    PR-–∫—Ä–∏–≤–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–ª–∏–∂–µ –∫ —Ç–æ—á–∫–µ (1, 1).
        
        """)
        

    # –ó–∞–≥—Ä—É–∑–∫–∞ confusion matrix –∏–∑ —Ñ–∞–π–ª–∞
    st.markdown("**–ì–†–ê–§–ò–ö ‚Ññ4 –ú–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ - –¥–µ—Ç–µ–∫—Ü–∏—è –æ–ø—É—Ö–æ–ª–µ–π –º–æ–∑–≥–∞ (YOLOv11):**")
    cm_image = Image.open("images/dinara_confusion_matrix.png")
    st.image(cm_image, caption="Confusion Matrix", use_container_width=True)

    st.markdown("""
        #### 3.1. –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç PR-–∫—Ä–∏–≤–∞—è?
    PR-–∫—Ä–∏–≤–∞—è –æ—Ç—Ä–∞–∂–∞–µ—Ç –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É:

    ##### Precision (–¢–æ—á–Ω–æ—Å—Ç—å) ‚Äî –¥–æ–ª—è –≤–µ—Ä–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö.

    –ü—Ä–∏–º–µ—Ä: 0.883 = 88.3% –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —è–≤–ª—è—é—Ç—Å—è –æ–ø—É—Ö–æ–ª—è–º–∏.

    ##### Recall (–ü–æ–ª–Ω–æ—Ç–∞) ‚Äî –¥–æ–ª—å –≤–µ—Ä–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –æ–ø—É—Ö–æ–ª–µ–π —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö.

     –ü—Ä–∏–º–µ—Ä: 0.6 = 60% –æ–ø—É—Ö–æ–ª–µ–π –Ω–∞–π–¥–µ–Ω–æ.

    –ß–µ–º –±–ª–∏–∂–µ –∫—Ä–∏–≤–∞—è –∫ –ø—Ä–∞–≤–æ–º—É –≤–µ—Ä—Ö–Ω–µ–º—É —É–≥–ª—É (Precision=1, Recall=1), —Ç–µ–º –ª—É—á—à–µ –º–æ–¥–µ–ª—å.
    
    #### 3.2. –ò–¥–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–∞–¥–∞—á
    Precision > 0.9 (–º–∏–Ω–∏–º—É–º –ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥–Ω–æ–∑–æ–≤).

    Recall > 0.8 (–ø–æ—á—Ç–∏ –≤—Å–µ –æ–ø—É—Ö–æ–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã).

    PR-–∫—Ä–∏–≤–∞—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–ª–∏–∂–µ –∫ —Ç–æ—á–∫–µ (1, 1).
        
        """)


